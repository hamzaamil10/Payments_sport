{% extends "league/base.html" %}
{% load static %}

{% block page_css %}
<link rel="stylesheet" href="{% static 'league/css/match_list.css' %}">
{% endblock %}

{% block content %}
<div class="list-head">
  <div>
    <h2 class="page-title">Matches</h2>
    <div class="muted">Upcoming and past matches â€” click a card to open details.</div>
  </div>
</div>

<div class="match-grid">
  {% for m in matches %}
    <a class="match-card card" href="{% url 'league:match_detail' m.pk %}">
      <div class="match-card-top">
        <div class="match-title">
          <span class="icon">âš½</span>
          <span>{{ m.title }}</span>
        </div>

        {% if m.final_score %}
          <span style="color: beige;"   class="badge badge-lock">Finalized ğŸ”’</span>
        {% else %}
          <span  style="color: rgb(88, 185, 19);"   class="badge badge-ok">Open âœ…</span>
        {% endif %}
      </div>

      <div class="match-meta">
        <div class="meta-item">
          <span class="meta-ic">ğŸ“…</span>
          <span>{{ m.date }} â€¢ {{ m.time }}</span>
        </div>
        <div class="meta-item">
          <span class="meta-ic">ğŸ“</span>
          <span>{{ m.location }}</span>
        </div>
        {% if m.price_per_player %}
        <div class="meta-item">
          <span class="meta-ic">ğŸ’°</span>
          <span>{{ m.price_per_player }} / player</span>
        </div>
        {% endif %}
      </div>

      <div class="match-people">
        <div class="people-left">
          <div class="confirmed">
            <span class="meta-ic">ğŸ‘¥</span>
            <strong style="color: aliceblue;">{{ m.confirmed_count }}</strong>
            <span style="color: aquamarine;"   class="muted">/ {{ m.max_players }} confirmed</span>
          </div>

          {# show first 6 confirmed names #}
          <div class="names">
            {% with confirmed=m.participations.all %}
              {% for p in confirmed %}
                {% if p.status == "going" %}
                  <span class="chip">
                    {{ p.player.nickname|default:p.player.user.username }}
                  </span>
                {% endif %}
                <!-- keep this comment here maybe need it after -->
                <!--<div class="names">
                    {% for p in m.participations.all %}
                        {% if p.status == "going" and forloop.counter <= 6 %}
                        <span class="chip">{{ p.player.nickname|default:p.player.user.username }}</span>
                        {% endif %}
  {% endfor %}
</div>-->
              {% endfor %}
            {% endwith %}
          </div>

          {# If too many, show +X #}
          {% with total=m.confirmed_count %}
            {% if total > 6 %}
              <div class="muted small">+{{ total|add:"-6" }} more</div>
            {% endif %}
          {% endwith %}
        </div>

        <div class="people-right">
          <span class="open-arrow">â†’</span>
        </div>
      </div>
    </a>
  {% empty %}
    <div class="card card-b">
      <h3>No matches yet</h3>
      <p class="muted">Create your first match from the admin panel.</p>
    </div>
  {% endfor %}
</div>
{% endblock %}
